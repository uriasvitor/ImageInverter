<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css">
    <title>Inversor de cor</title>
</head>

<body>
    <div class="section-drop">
        <form>
            <input class="file-input" type="file" onchange="preview()">
                <div class="dimension">
                    <label for="altura">Altura</label>
                    <input type="number" id="altura" name="altura" 
                    value="470"
                    required
                    >

                    <label for="largura">Largura</label>
                    <input type="number" id="largura" name="largura" 
                    required
                    value="270"
                    >
                </div>

                <div class="box">
                    <div class="preview-img">
                        <img id="previewImg" src="" />
                    </div>
                </div>
            <div class="controls">
                <button class="btn-inversor">Ver a cor</button>
                <button id="btn-save" disabled>Baixar</div>
            </div>
        </form>
    </div>
</body>

<script>
    
const fileInput = document.querySelector(".file-input");
const saveImgBtn = document.querySelector("#btn-save");
let previewImg = document.querySelector(".preview-img img");

function preview() {
    let file = fileInput.files[0];
    previewImg.src = URL.createObjectURL(file);

    document.getElementById("previewImg").style.filter = "invert(0)"
    document.getElementById("btn-save").disabled = false;
    
}

document.querySelector(".btn-inversor").addEventListener("click",(e)=>{
    e.preventDefault();

     document.getElementById("previewImg").style.filter = "invert(1)"
   

})

const saveImg = (e) =>{
    e.preventDefault()

    let imgWidth = document.getElementById("largura").value;
    let imgHeight = document.getElementById("altura").value;

    console.log(`${imgHeight} ${imgWidth}`)

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = imgWidth;
    canvas.height = imgHeight;
    console.log("create canvas")
    
    ctx.filter = 'invert(1)'
    ctx.drawImage(previewImg, 0, 0, canvas.width, canvas.height)
    ctx.drawImage(previewImg, -canvas.width / 100, -canvas.height / 100, canvas.width, canvas.height);

    document.body.appendChild(canvas)

    const link = document.createElement("a");
    link.download = "image.jpg";
    link.href = canvas.toDataURL();
    link.click();
}


saveImgBtn.addEventListener("click", saveImg);
</script>
</html>